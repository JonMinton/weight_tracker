---
title: "Weight Tracker"
output: html_notebook
---

# Introduction

This will track and try to make sense of changes in weight over time. The data will have to be manually recorded on an Excel workbook.


# Packages etc

```{r}
pacman::p_load(
  openxlsx, tidyverse, plotly
)

```
Data 


```{r}
data <- readxl::read_excel("weight_over_time.xlsx", sheet = "raw_data", col_types = c("date", "skip", "numeric", "skip"))

```

# Find AM and PM

```{r}
delta_data <- 
  data %>% 
    mutate(
      tod = ifelse(lubridate::am(date), "AM", "PM")
    ) %>% 
    mutate(
      day_alone = lubridate::as_date(date)
    ) %>% 
    select(day_alone, tod, weight) %>% 
    group_by(day_alone, tod) %>% 
    summarise( min_max_weight = case_when(
      tod[1] == "AM" ~ min(weight),
      tod[1] == "PM" ~ max(weight)
      )
    )

```

Now to visualise 


```{r, fig.height=6, fig.width = 8}

# regression model
mod <- lm(min_max_weight ~ day_alone + tod, data = delta_data)

# get equation
# https://stackoverflow.com/questions/7549694/add-regression-line-equation-and-r2-on-graph

lm_eqn <- function(m){
  m_tidy <- broom::tidy(mod)
  trend_point <- m_tidy %>% pluck(2, 2) %>% round(2)
  trend_se    <- m_tidy %>% pluck(3, 2) %>% `*`(2) %>% round(2)
  daily_point <- m_tidy %>% pluck(2, 3) %>% round(2) 
  daily_se    <- m_tidy %>% pluck(3, 3) %>% `*`(2) %>% round(2)
  glue::glue("Daily fall of {trend_point} (\u00b1 {trend_se})\n
             Daily variation of {daily_point} (\u00b1 {daily_se})\n
             Ratio: {round(abs(daily_point / trend_point), 2)}")
}

delta_data %>% 
  modelr::add_predictions(., mod) %>% 
  ggplot(aes(x = day_alone)) + 
  geom_point(aes(y = min_max_weight, shape = tod, group = tod, colour = tod)) + 
  geom_line(aes(y = pred, group = tod, colour = tod)) +
  scale_y_continuous(breaks = 72:78) + 
  scale_x_date(breaks = "1 week", 
               minor_breaks = "1 day",
               labels = scales::date_format("%d %b") 
               ) + 
  expand_limits(y = c(72, 78)) + 
  labs(
    x = "Date",
    y = "Weight in kg"
  ) + 
  geom_hline(yintercept = 72.7, linetype = "dashed", size = 1.5) + 
  geom_hline(yintercept = 74.2, linetype = "solid", colour = "darkblue") +
  geom_text(x = as.Date("2020-08-12"), y = 77.5, label = lm_eqn(mod), colour = "black", hjust = 0)
  
```



And linear regression

```{r}
mod <- lm(min_max_weight ~ day_alone + tod, data = delta_data)

```

```{r}
summary(mod)

```


So, on the basis of this there's a statistically significant downward trend of about 0.09 kg / day, but this is dwarfed by daily variation which is around 1.3 kg / day, i.e. 10x its magnitude
